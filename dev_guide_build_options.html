<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Intel(R) MKL-DNN: Build Options</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script src="assets/mathjax/MathJax.js?config=TeX-AMS_CHTML"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
<link href="assets/customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="assets/dnn.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname">Intel(R) Math Kernel Library for Deep Neural Networks (Intel(R) MKL-DNN)
   &#160;<span id="projectnumber">0.95.0</span>
   </div>
   <div id="projectbrief">Performance library for Deep Learning</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Build Options </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Configuring the Build</h2>
<p>Intel MKL-DNN supports the following build-time options.</p>
<table class="doxtable">
<tr>
<th align="left">Option </th><th align="left">Supported values (defaults in bold) </th><th align="left">Description  </th></tr>
<tr>
<td align="left">MKLDNN_LIBRARY_TYPE </td><td align="left"><b>SHARED</b>, STATIC </td><td align="left">Defines the resulting library type </td></tr>
<tr>
<td align="left">MKLDNN_THREADING </td><td align="left"><b>OMP</b>, OMP:INTEL, OMP:COMP, TBB </td><td align="left">Defines the threading type </td></tr>
<tr>
<td align="left">MKLDNN_USE_MKL </td><td align="left"><b>DEF</b>, NONE, ML, FULL, FULL:STATIC </td><td align="left">Defines the binary dependency on Intel MKL </td></tr>
<tr>
<td align="left">MKLDNN_GPU_BACKEND </td><td align="left"><b>NONE</b>, OPENCL </td><td align="left">Defines the backend for GPU engine </td></tr>
<tr>
<td align="left">MKLDNN_BUILD_EXAMPLES </td><td align="left"><b>ON</b>, OFF </td><td align="left">Controls building the examples </td></tr>
<tr>
<td align="left">MKLDNN_BUILD_TESTS </td><td align="left"><b>ON</b>, OFF </td><td align="left">Controls building the tests </td></tr>
<tr>
<td align="left">MKLDNN_ARCH_OPT_FLAGS </td><td align="left"><em>compiler flags</em> </td><td align="left">Specifies compiler optimization flags (see warning note below) </td></tr>
<tr>
<td align="left">MKLDNN_ENABLE_JIT_PROFILING </td><td align="left"><b>ON</b>, OFF </td><td align="left">Enables integration with Intel(R) VTune(TM) Amplifier </td></tr>
</table>
<h2>Targeting Specific Architecture</h2>
<p>Intel MKL-DNN uses JIT code generation to implement most of its functionality and will choose the best code based on detected processor features. However, some Intel MKL-DNN functionality will still benefit from targeting a specific processor architecture at build time. You can use <code>MKLDNN_ARCH_OPT_FLAGS</code> CMake option for this.</p>
<p>For Intel(R) C++ Compilers, the default option is <code>-xHOST</code>, which instructs the compiler to generate the code for the architecture of the processor where the build is occurring. This option would not allow you to run the library on older processor architectures.</p>
<p>For GNU* Compiler 5.0 and newer, the default options are <code>-march=native -mtune=native</code>.</p>
<dl class="section warning"><dt>Warning</dt><dd>While use of <code>MKLDNN_ARCH_OPT_FLAGS</code> option gives better performance, the resulting library can be run only on systems that have instruction set compatible with the target instruction set. Therefore, <code>ARCH_OPT_FLAGS</code> should be set to an empty string (<code>""</code>) if the resulting library needs to be portable.</dd></dl>
<h2>GPU support (experimental)</h2>
<p>To enable GPU support in Intel MKL-DNN you need to specify the GPU backend to use. Currently the only supported one is implemented using OpenCL* and requires Intel(R) SDK for OpenCL* applications. You can explicitly specify the pass to the SDK using <code>-DOPENCLROOT</code> cmake option.</p>
<div class="fragment"><div class="line">cmake -DMKLDNN_GPU_BACKEND=OPENCL -DOPENCLROOT=/path/to/opencl/sdk ..</div>
</div><!-- fragment --><h2>Threading</h2>
<p>Intel MKL-DNN can use the OpenMP or TBB threading runtimes. OpenMP threading is the default build mode and is recommended for the best performance. TBB support is experimental. This behavior is controlled by the <code>MKLDNN_THREADING</code> CMake option.</p>
<h3>OpenMP</h3>
<p>Intel MKL-DNN can use the Intel, GNU, or Clang OpenMP runtimes. Because different OpenMP runtimes may not be binary-compatible, it's important to ensure that only one OpenMP runtime is used throughout the application. Having more than one OpenMP runtime linked to an executable may lead to undefined behavior including incorrect results or crashes.</p>
<p>The Intel MKL-DNN library linked with Intel MKL (full or small libraries version) link to the Intel OpenMP runtime included with the Intel MKL. The Intel OpenMP runtime is binary compatible with the GNU OpenMP and Clang OpenMP runtimes and is recommended for the best performance results.</p>
<p>If Intel MKL-DNN library is built standalone, it will link to the OpenMP library supplied by the compiler. This means that there would be no conflicts as long as both the library and the application use the same or compatible compilers.</p>
<h3>TBB</h3>
<p>TBB support is experimental.</p>
<p>To build Intel MKL-DNN with TBB support, set the <code>TBBROOT</code> environmental variable to point to the TBB installation path or pass the path directly to cmake:</p>
<div class="fragment"><div class="line">$ cmake -DTBBROOT=/opt/intel/path/tbb ..</div>
</div><!-- fragment --><p>Intel MKL-DNN has limited optimizations for Intel TBB and has some functional limitations if built with Intel TBB.</p>
<p>Functional limitations:</p>
<ul>
<li>Winograd convolution algorithm is not supported.</li>
</ul>
<p>The following primitives have lower performance compared to OpenMP (mostly due to limited parallelism):</p>
<ul>
<li>Batch normalization,</li>
<li>Convolution backward by weights,</li>
<li>Inner product,</li>
<li><code>mkldnn_*gemm()</code>.</li>
</ul>
<h2>Linking to Intel(R) MKL</h2>
<p>Intel MKL-DNN can be configured to use Intel MKL via the <code>MKLDNN_USE_MKL</code> CMake option. Using Intel MKL may improve performance on older platforms not supported by the matrix-matrix multiplication routine implemented in Intel MKL-DNN itself.</p>
<p>If you choose to build Intel MKL-DNN with the binary dependency, download the Intel MKL small libraries using the provided script:</p>
<ul>
<li>Linux/macOS <div class="fragment"><div class="line">cd scripts &amp;&amp; ./prepare_mkl.sh &amp;&amp; cd ..</div>
</div><!-- fragment --></li>
<li>Windows <div class="fragment"><div class="line">cd scripts &amp;&amp; call prepare_mkl.bat &amp;&amp; cd ..</div>
</div><!-- fragment --></li>
</ul>
<p>You can also download the small libraries from <a href="https://github.com/intel/mkl-dnn/releases">GitHub release section</a>. You need to unpack the archive in the <code>external</code> directory of the repository root or set <code>MKLROOT</code> environment variable to point to the installation location of the small libraries of full Intel MKL library.</p>
<dl class="section note"><dt>Note</dt><dd>Intel MKL small libraries are currently only compatible with OpenMP threading. You need the full Intel MKL library to use Intel MKL and TBB threading. Using Intel MKL or Intel MKL small libraries will introduce additional runtime dependencies. For additional information, refer to the Intel MKL <a href="https://software.intel.com/en-us/articles/intel-math-kernel-library-intel-mkl-2019-system-requirements">system requirements</a>.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>If the library is built with TBB threading, the user is expected to set the <code>MKL_THREADING_LAYER</code> environment variable to either <code>tbb</code> or <code>sequential</code> in order to force Intel MKL to use Intel TBB for parallelization or to be sequential, respectively. Without this setting, Intel MKL (the <code>mkl_rt</code> library) uses the OpenMP threading by default. </dd></dl>
</div></div><!-- contents -->
<div class="footer">
    <div class="footer-wrapper">
        <ul id="footer-links">
            <li><a href="legal_information.html">Legal information</a></li>
        </ul>
    </div>
</div>